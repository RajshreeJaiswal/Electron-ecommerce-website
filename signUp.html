<!DOCTYPE html>
<html>
<head>
  <title>SignUp</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="parent">
    <h2>Create an  account</h2>
    <form id="form">
      

      <div class="child">
        <label for="username">* Full Name</label>
        <input type="text" id="name" required>
      </div>

      <div class="child">
        <label for="email">* Email address</label>
        <input type="email" id="email" required>
      </div>

      <div class="child">
        <label for="confirmemail">* Confirm Email address</label>
        <input type="email" id="cm" required>
      </div>

      <div class="child">
        <label for="password" >* Password</label>
        <input type="password" id="pass" required>
      </div>

      <div class="child">
        <label for="confirmpassword">* Confirm Password</label>
        <input type="password" id="cp" required>
      </div>

      <div class="child">
        <label for="phone">Cell Phone Number</label>
        <input type="number" id="pnumber" required>
      </div>

      <div class="child">
        <label for="referal">Referral Code <span>(Optional)</span></label>
        <input type="number" id="rnumber">
      </div>

      <div class="child">
        <button type="submit">Sign Up</button>
      </div>
      
    </form>
  </div>
  <div class="gl">
    <h1>Or</h1>
    <p>Sign Up with </p>
    <button id="google">Google</button>
  </div>
  <div class="parent">
    <h2>Already Existing Customers</h2>
    <button type="button"><a href="./login.html">CONTINUE</a></button>
  </div>
  
</body>
</html>
<script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithPopup, 
    GoogleAuthProvider
  } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

  import {
    getDatabase,
    ref,
    set,
  } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
   
    const firebaseConfig = {
      apiKey: "AIzaSyDW-CMV7MCDmGJw4m13DQxOidgVzfLyzew",
      authDomain: "thiruelectron.firebaseapp.com",
    //   databaseURL: "https://thiruelectron-default-rtdb.firebaseio.com",
      projectId: "thiruelectron",
      storageBucket: "thiruelectron.appspot.com",
      messagingSenderId: "190341230302",
      appId: "1:190341230302:web:efe7c8cedc68a715789c4f"
    };
  
    
    const app = initializeApp(firebaseConfig);
    console.log(app)

    const database = getDatabase();
  const auth = getAuth();

    let fm=document.querySelector('#form')
  
   
  
  
  fm.addEventListener('submit',(event)=>{
      event.preventDefault();
      let fn=document.querySelector('#name').value
      let email=document.querySelector('#email').value
      let cm=document.querySelector('#cm').value
     let pass=document.querySelector('#pass').value
     let cp=document.querySelector('#cp').value
     let ph=document.querySelector('#pnumber').value
      
      let userId = Math.round(Math.random() * 10);

      if(email===cm && pass===cp){
        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed in
          const user = userCredential.user;
          set(ref(database, "users/" + userId), {
            username: `${fn}`,
            email: email,
            phoneNumber:ph,
            
          });
          localStorage.setItem("userId", userId);
          console.log(user);
          alert("registered successfully");
          // location.href = "./home.html";
          // ...
        }).catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;

          console.log(errorMessage);
          // ..
        });
      }else{
        alert('email or password is mismatched')
      }
        
  })
  
 let google=document.querySelector('#google')

 const provider = new GoogleAuthProvider(); 
 google.addEventListener('click',(event)=>{
  event.preventDefault();

  signInWithPopup(auth, provider)
  .then((result) => {
    
    const credential = GoogleAuthProvider.credentialFromResult(result);
    const token = credential.accessToken;
    
    const user = result.user;
    console.log(user)
    alert('Registered succesfull')
    // location.href = "./home.html";
  }).catch((error) => {
    
    const errorCode = error.code;
    const errorMessage = error.message;
    
    const email = error.customData.email;
    
    const credential = GoogleAuthProvider.credentialFromError(error);
    
  });

 })

  </script>
