<!DOCTYPE html>
<html>
<head>
  <title>SignIn</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="parent"> 
    
    <h2>Existing Customers</h2>
    <form id="form">
      <div class="child">
        <label for="email">* Email address</label>
        <input type="email" id="email" required>
      </div>

      <div class="child">
        <label for="password" >* Password</label>
        <input type="password" id="pass" required>
      </div>

      <div class="child">
        <button type="submit">Sign In</button>
      </div>
    </form>
    <a href="" style="margin-top: 10px;">FORGOT YOUR PASSWORD?</a>
  </div>
  <div class="gl">
    <h1>Or</h1>
    <p>Sign In with </p>
    <button id="google">Google</button>
  </div>
  <div class="parent">
    <h2>New Customers</h2>
    <button type="submit"><a href="./signUp.html">CONTINUE</a></button>
  </div>
  
</body>
</html>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    signOut,
    signInWithPopup, 
    GoogleAuthProvider
  } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

  import {
    getDatabase,
    ref,
    onValue,
  } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
      apiKey: "AIzaSyDW-CMV7MCDmGJw4m13DQxOidgVzfLyzew",
      authDomain: "thiruelectron.firebaseapp.com",
    //   databaseURL: "https://thiruelectron-default-rtdb.firebaseio.com",
      projectId: "thiruelectron",
      storageBucket: "thiruelectron.appspot.com",
      messagingSenderId: "190341230302",
      appId: "1:190341230302:web:efe7c8cedc68a715789c4f"
    };
  

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

  console.log(app);

  const auth = getAuth();
  const db = getDatabase();

  let fm=document.querySelector('#form')
  fm.addEventListener("submit", function (event) {
    event.preventDefault();

   let email=document.querySelector('#email').value
   let    password=document.querySelector('#pass').value
    let userId = localStorage.getItem("userId");

    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Signed in
        const user = userCredential.user;

        const starCountRef = ref(db, "users/" + userId);
        onValue(starCountRef, (snapshot) => {
          const data = snapshot.val();
          console.log(data);
        });
        console.log(user);
        alert("you are logged in");
        // location.href = "./home.html";
        
        // ...
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.log(errorMessage);
        alert(`${errorMessage}`);
      });
  });

  let google=document.querySelector('#google')

 const provider = new GoogleAuthProvider(); 
 google.addEventListener('click',(event)=>{
  event.preventDefault();

  signInWithPopup(auth, provider)
  .then((result) => {
    
    const credential = GoogleAuthProvider.credentialFromResult(result);
    const token = credential.accessToken;
    
    const user = result.user;
    console.log(user)
    alert('you are logged in')
    // location.href = "./home.html";
  }).catch((error) => {
    
    const errorCode = error.code;
    const errorMessage = error.message;
    
    const email = error.customData.email;
    
    const credential = GoogleAuthProvider.credentialFromError(error);
    
  });

 })

  //for logout button
  // document.getElementById("logout").addEventListener("click", function () {
  //   signOut(auth)
  //     .then(() => {
  //       // Sign-out successful.
  //       alert("logout successfully");
  //       location.href = "./login.html";
  //     })
  //     .catch((error) => {
  //       // An error happened.
  //     });
  // });
</script>

